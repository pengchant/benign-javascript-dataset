
var isLogin=0
var _hmt = _hmt || [];
var pageInfo = {
	canForward:"1",
    id: "304484",
    praiseNum:"0"
}
var dtid = "306353";
var marking = "fe";
var user = {
    uid : ''
}
var authorUid = {
    uid : '8668931'
}
var curPage = 'details'

var a_id = 304484

// 为html转码，article_content 为新markdown编辑器接收的初始化内容
var article_content = "&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;不需要下载安装，便可以在微信好友、微信群之间快速的转发，用户只需要扫码或者在微信里点击，就可以立即运行，有着近似APP的用户体验，使得微信小程序成为全民热爱的好东西~&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;同时因为微信小程序使用的是Javascript语法，对前端开发人员而言，几乎是没有学习成本和技术门槛的。对于大部分场景，都可以使用小程序快速开发实现，不论是开发周期还是开发成本都低的让人笑哭，所以受到了技术开发团队的各种追捧~&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;但如果要在小程序里快速的实现一个即时通讯功能，就有点尴尬，因为微信官方提供的只是一个底层的websocket api，要在项目中直接使用，还需要做很多额外的工作，比如首先就需要搭建自己的websocket服务~&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;那有没有简单的方式呢？ 当然是有的！&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;今天小编就手把手的教您用GoEasy在微信小程序里，最短的时间快速实现一个websocket即时通讯Demo。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;&lt;img src=&quot;http://img4.sycdn.imooc.com/5eb8c0bd0001c81702600234.jpg&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;本demo已经完成了真机下的小程序的测试，完整源代码开源到oschina的码云上，clone后，只需要将代码里的appkey换成自己的common key，就可以体验了, 源码网址：&lt;a href=&quot;https://gitee.com/goeasy-io/GoEasyDemo-wxapp-Helloworld&quot;&gt;https://gitee.com/goeasy-io/GoEasyDemo-wxapp-Helloworld&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h1&gt;1、获取appkey&lt;/h1&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;GoEasy官网（&lt;a href=&quot;https://www.goeasy.io/&quot;&gt;https://www.goeasy.io/&lt;/a&gt;）上注册账号，创建一个应用，拿到您的appkey。&lt;br /&gt;&lt;img src=&quot;http://img1.sycdn.imooc.com/5eb8c0bd0001d86908690414.jpg&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;&lt;strong&gt;GoEasy提供了两种类型的appkey：&lt;/strong&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;ul&gt;&lt;li&gt;\n&lt;p&gt;Common key: 即可以接收消息，也可以发送消息，与Subscribe Key最大的区别就是有写权限，可以发消息。适用于有消息发送需求的客户端和服务端开发。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;Subscribe key: 只能接收消息，不可以发送消息，与Common Key最大的区别就是没有写权限，只能收消息。可以用于一些没有发送需求的客户端。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h1&gt;2、获取GoEasy SDK&lt;/h1&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;下载 &lt;a href=&quot;https://cdn.goeasy.io/download/goeasy-1.0.11.js&quot;&gt;https://cdn.goeasy.io/download/goeasy-1.0.11.js&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre&gt;&lt;code&gt;import GoEasy from &apos;./goeasy-1.0.11&apos;;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h1&gt;3、初始化GoEasy对象&lt;/h1&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre&gt;&lt;code&gt;var self = this;\nthis.goeasy = GoEasy({\n    host: &apos;hangzhou.goeasy.io&apos;,\n    appkey: &quot;您的appkey&quot;,\n    onConnected: function () {\n        console.log(&quot;GoEasy connect successfully.&quot;);\n        self.unshiftMessage(&quot;连接成功.&quot;);\n    },\n    onDisconnected: function () {\n        console.log(&quot;GoEasy disconnected.&quot;)\n        self.unshiftMessage(&quot;连接已断开.&quot;);\n    },\n    onConnectFailed: function (error) {\n        console.log(error);\n        self.unshiftMessage(&quot;连接失败，请检查您的appkey和host配置&quot;);\n    }\n})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;根据您在GoEasy后台创建应用时选择的区域，来传入不同的Host,如果您创建GoEasy应用时,选择了杭州，那么host:“hangzhou.goeasy.io”。选择了新加坡,host:“singapore.goeasy.io”。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;如果您的大部分用户都是在国内，创建应用时，记得选择杭州，以便获得更快的通讯速度。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h1&gt;4、小程序端接收消息&lt;/h1&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre&gt;&lt;code&gt;var self = this;\nthis.goeasy.subscribe({\n    channel: &quot;my_channel&quot;,\n    onMessage: function (message) {\n        self.unshiftMessage(message.content);\n    },\n    onSuccess: function () {\n        self.unshiftMessage(&apos;订阅成功.&apos;);\n    }\n});\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;很多朋友会问channel从哪里来，如何创建，应该传入什么呢？&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;根据您的业务需求来设定，channel可以为任意字符串，除了不能包含空格，和不建议使用中文外，没有任何限制，只需要和消息的发送端保持一致，就可以收到消息。channel可以是您直播间的uuid,也可以是一个用户的唯一表示符，可以任意定义，channel不需要创建，可以随用随弃。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h1&gt;5、小程序端发送消息：&lt;/h1&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;发送时，需要注意channel一定要和subscribe的channel完全一致，否则无法收到。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre&gt;&lt;code&gt;this.goeasy.publish({\n    channel: &quot;my_channel&quot;,\n    message: self.data.message,\n    onSuccess: function () {\n        self.setData({\n            message: &apos;&apos;\n        }); //清空发送消息内容\n        console.log(&quot;send message success&quot;);\n    },\n    onFailed: function (error) {\n        self.unshiftMessage(&apos;发送失败，请检查您的appkey和host配置.&apos;);\n    }\n});\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;本代码源码下载：&lt;a href=&quot;https://gitee.com/goeasy-io/GoEasyDemo-wxapp-Helloworld&quot;&gt;https://gitee.com/goeasy-io/GoEasyDemo-wxapp-Helloworld&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;&lt;strong&gt;特别强调：&lt;/strong&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;在运行之前，一定要在微信公众号平台配置socket合法域名，否则无法建立连接。具体步骤：&lt;br /&gt;\n访问&lt;a href=&quot;https://mp.weixin.qq.com&quot;&gt;https://mp.weixin.qq.com&lt;/a&gt;，进入微信公众平台|小程序 -&amp;gt; 设置 -&amp;gt; 开发设置 -&amp;gt; 服务器域名&lt;br /&gt;\nsocket合法域名-&amp;gt; 添加GoEasy的地址： wx-hangzhou.goeasy.io（记得wx-开头）&lt;br /&gt;\n若您创建GoEasy应用时选择了新加坡区域则添加地址：wx-singapore.goeasy.io&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h1&gt;答疑时间：&lt;/h1&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h4&gt;1、我的服务器端可以给小程序发送消息吗？都支持些哪些语言？&lt;/h4&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;当然可以，任何语言都可以通过调用GoEasy的Rest API发送消息，同时为了大家方便，GoEasy的官方文档里，也准备了Java, C#,NodeJS，PHP，Ruby和Python等常见语言调用REST API的代码，这里获取更多详情：&lt;a href=&quot;https://www.goeasy.io/cn/doc/server/publish.html&quot;&gt;https://www.goeasy.io/cn/doc/server/publish.html&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h4&gt;2、GoEasy可以发送图片，语音和视频吗？&lt;/h4&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;当然可以，您可以通过推送文件路径的方式来实现文件的发送。&lt;br /&gt;\n按照行业惯例，不论MSN，微信，QQ对于图片和视频，通常的做法都是，只推送文件路径，而不会推送文件本身。你如果有注意的话，当您接受图片和视频的时候，收到消息后，等一会儿才能看，就是因为发送的时候，只发送了路径。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h4&gt;3、GoEasy和微信小程序官方的websocket API有什么区别和优势？&lt;/h4&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;小程序官方的websocket API主要是用来与您的websocket服务通讯，所以使用小程序websocket的前提是，首先要搭建好您自己的websocket服务，然后与之通讯。这是一个纯技术的API，在建立网络连接后，还有很多的工作需要自己来完成，比如：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;ul&gt;&lt;li&gt;需要自己实现心跳机制，来维护网络连接，来判断客户端的网络连接状态；&lt;/li&gt;\n&lt;li&gt;需要自己实现断网自动重连；&lt;/li&gt;\n&lt;li&gt;需要自己维护消息列表，确保遇到断网重连后，消息能够补发；&lt;/li&gt;\n&lt;li&gt;需要自己维护一个客户端列表；&lt;/li&gt;\n&lt;li&gt;等等很多细致而繁杂的工作，比如websocket的安全机制和性能优化；&lt;/li&gt;\n&lt;/ul&gt;&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;此之外服务端也有很多工作需要自己完成，有兴趣自己搭建websocket的话，可以参考这篇技术分享《&lt;a href=&quot;https://www.imooc.com/article/303947&quot;&gt;搭建websocket消息推送服务，必须要考虑的几个问题&lt;/a&gt;》&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;而GoEasy是一个成熟稳定的企业级websocket PAAS服务平台，开发人员不需要考虑websocket服务端的搭建，只需要几行代码，就可以轻松实现客户端与客户端之间，服务器与客户端之间的的websocket通信，不需要考虑性能，安全，高可用集群的问题,只需要全力专注于开发自己的业务功能就好了。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;GoEasy已经内置websocket中必备的心跳，断网重连，消息补发，历史消息和客户端上下线提醒等特性，开发人员也不需要自己搭建websocket服务处理集群高可用，安全和性能问题。GoEasy已经稳定运行了5年，支持千万级并发，成功支撑过很多知名企业的重要活动，安全性和可靠性都是久经考验。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h4&gt;4、GoEasy在小程序的开发中主要用在那些场景呢？&lt;/h4&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;从应用场景上来说，所有需要websocket通信的场景，GoEasy都可以完美支持：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;ul&gt;&lt;li&gt;聊天，IM，直播弹幕，用户上下线提醒, 在线用户列表&lt;/li&gt;\n&lt;li&gt;扫码点菜，扫码登录， 扫码支付， 扫码签到， 扫码打印&lt;/li&gt;\n&lt;li&gt;事件提醒，工单，订单实时提醒&lt;/li&gt;\n&lt;li&gt;在线拍卖， 在线点餐，在线选座 实时数据展示，实时监控大屏， 金融实时行情显示，设备监控系统&lt;/li&gt;\n&lt;li&gt;实时位置跟踪，外卖实时跟踪，物流实时跟踪&lt;/li&gt;\n&lt;li&gt;远程画板，远程医疗，游戏，远程在线授课&lt;/li&gt;\n&lt;/ul&gt;&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h4&gt;5、GoEasy的文档为什么这么简单？简单到我都不知道如何使用&lt;/h4&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;简单还不好吗？GoEasy从研发的第一天，就把追求API的极简作为我们的工作重点。严格控制接口的数量，就是是为了降低开发人员的学习成本，其实就是为了让您爽啊！但这并不影响GoEasy完美支持所有的websocket即时通讯需求。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;GoEasy官网：&lt;a href=&quot;https://www.goeasy.io&quot;&gt;https://www.goeasy.io&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;";
// 为html反转码
article_content = article_content.replace(/\&lt\;/g, "<").replace(/\&gt\;/g, ">").replace(/\&amp\;/g, "&").replace(/\&quot\;/g, '"').replace(/\&apos\;/g, "'");
// 递归遍历dom，处理图片懒加载
function dfs(root) {
	var nodes = Array.prototype.slice.call(root.children);
	if (nodes.length) {
		nodes.forEach(function (node) {
			if(node.tagName == 'IMG') {
				var src = node.src;
				var alt = node.alt;
				var reg = /(?:imooc|mukewang)\.com\/[A-Za-z0-9]+?\.jpg$/;
				// ueditor 上传的图片，alt为原图高清
				if(reg.test(alt)) {
					!node.getAttribute('data-src') && node.setAttribute('data-src', alt);
					node.setAttribute('data-original', alt); // 直接显示原图
				} else {
					node.setAttribute('data-original', src);
				}
				node.setAttribute('class', 'lazyload');
				node.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC';
			}
			dfs(node);
		});
	}
}
// 创建手记内容dom节点
var articleEl = document.createElement("div");
articleEl.innerHTML = article_content;
// 遍历手记dom树
dfs(articleEl);
