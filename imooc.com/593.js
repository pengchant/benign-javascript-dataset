
var isLogin=0
var _hmt = _hmt || [];
var pageInfo = {
	canForward:"1",
    id: "300259",
    praiseNum:"0"
}
var dtid = "302064";
var marking = "mobile";
var user = {
    uid : ''
}
var authorUid = {
    uid : '4595625'
}
var curPage = 'details'

var a_id = 300259

// 为html转码，article_content 为新markdown编辑器接收的初始化内容
var article_content = "&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;blockquote&gt;\n&lt;p&gt;Select 并不是什么新鲜概念，我们在 IO 多路复用的时候就见过它，在 Java NIO 里面也见过它。接下来给各位介绍的是 Kotlin 协程的 Select。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h2&gt;复用多个 await&lt;/h2&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;我们前面已经接触了很多挂起函数，那么如果我有这样一个场景，两个 API 分别从网络和本地缓存获取数据，期望哪个先返回就先用哪个做展示：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;prism language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; CoroutineScope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUserFromApi&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;login&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Dispatchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IO&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    gitHubServiceApi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUserSuspend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;login&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; CoroutineScope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUserFromLocal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;login&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Dispatchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IO&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token function&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;localDir&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; login&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;takeIf&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exists&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; gson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;it&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; User&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;不管先调用哪个 API 返回的 &lt;code&gt;Deferred&lt;/code&gt; 的 &lt;code&gt;await&lt;/code&gt;，都会被挂起，如果想要实现这一需求就要启动两个协程来调用 &lt;code&gt;await&lt;/code&gt;，这样反而将问题复杂化了。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;接下来我们用 &lt;code&gt;select&lt;/code&gt; 来解决这个问题：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;prism language-kotlin&quot;&gt;GlobalScope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;launch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; localDeferred &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUserFromLocal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;login&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; remoteDeferred &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUserFromApi&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;login&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; userResponse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; select&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Response&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        localDeferred&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onAwait&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;it&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n        remoteDeferred&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onAwait&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;it&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;大家可以看到，我们没有直接调用 &lt;code&gt;await&lt;/code&gt;，而是调用了 &lt;code&gt;onAwait&lt;/code&gt; 在 &lt;code&gt;select&lt;/code&gt; 当中注册了个回调，不管哪个先回调，&lt;code&gt;select&lt;/code&gt; 立即返回对应回调中的结果。假设 &lt;code&gt;localDeferred.onAwait&lt;/code&gt; 先返回，那么 &lt;code&gt;userResponse&lt;/code&gt; 的值就是 &lt;code&gt;Response(it, true)&lt;/code&gt;，当然由于我们的本地缓存可能不存在，因此 &lt;code&gt;select&lt;/code&gt; 的结果类型是 &lt;code&gt;Response&amp;lt;User?&amp;gt;&lt;/code&gt;。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;对于这个案例本身，如果先返回的是本地缓存，那么我们还需要获取网络结果来展示最新结果：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;prism language-kotlin&quot;&gt;GlobalScope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;launch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;\n    userResponse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;it&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    userResponse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;takeIf&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; userFromApi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remoteDeferred&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token function&quot;&gt;cacheUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;login&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userFromApi&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userFromApi&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h2&gt;复用多个 Channel&lt;/h2&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;对于多个 &lt;code&gt;Channel&lt;/code&gt; 的情况，也比较类似：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;prism language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; channels &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Channel&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\nselect&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    channels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;\n        channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onReceive&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n        &lt;span class=&quot;token comment&quot;&gt;// OR&lt;/span&gt;\n        channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onReceiveOrNull&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;对于 &lt;code&gt;onReceive&lt;/code&gt;，如果 &lt;code&gt;Channel&lt;/code&gt; 被关闭，&lt;code&gt;select&lt;/code&gt; 会直接抛出异常；而对于 &lt;code&gt;onReceiveOrNull&lt;/code&gt; 如果遇到 &lt;code&gt;Channel&lt;/code&gt; 被关闭的情况，&lt;code&gt;it&lt;/code&gt; 的值就是 &lt;code&gt;null&lt;/code&gt;。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h2&gt;SelectClause&lt;/h2&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;我们怎么知道哪些事件可以被 &lt;code&gt;select&lt;/code&gt; 呢？其实所有能够被 &lt;code&gt;select&lt;/code&gt; 的事件都是 &lt;code&gt;SelectClauseN&lt;/code&gt; 类型，包括：&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;ul&gt;&lt;li&gt;\n&lt;p&gt;&lt;code&gt;SelectClause0&lt;/code&gt;：对应事件没有返回值，例如 &lt;code&gt;join&lt;/code&gt; 没有返回值，对应的 &lt;code&gt;onJoin&lt;/code&gt; 就是这个类型，使用时 &lt;code&gt;onJoin&lt;/code&gt; 的参数是一个无参函数：&lt;/p&gt;\n&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;prism language-kotlin&quot;&gt;select&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Unit&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onJoin&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Join resumed!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;code&gt;SelectClause1&lt;/code&gt;：对应事件有返回值，前面的 &lt;code&gt;onAwait&lt;/code&gt; 和 &lt;code&gt;onReceive&lt;/code&gt; 都是此类情况。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;code&gt;SelectClause2&lt;/code&gt;：对应事件有返回值，此外还需要额外的一个参数，例如 &lt;code&gt;Channel.onSend&lt;/code&gt; 有两个参数，第一个就是一个 &lt;code&gt;Channel&lt;/code&gt; 数据类型的值，表示即将发送的值，第二个是发送成功时的回调：&lt;/p&gt;\n&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;prism language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; element &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;\n    select&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Unit&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        channels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; channel &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt;\n            channel&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onSend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; sentChannel &lt;span class=&quot;token operator&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sent on &lt;span class=&quot;token interpolation variable&quot;&gt;$sentChannel&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;在消费者的消费效率较低时，数据能发给哪个就发给哪个进行处理，&lt;code&gt;onSend&lt;/code&gt; 的第二个参数的参数是数据成功发送到的 &lt;code&gt;Channel&lt;/code&gt; 对象。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;因此如果大家想要确认挂起函数是否支持 &lt;code&gt;select&lt;/code&gt;，只需要查看其是否存在对应的 &lt;code&gt;SelectClauseN&lt;/code&gt; 即可。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;h2&gt;小结&lt;/h2&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;在协程当中，Select 的语义与 Java NIO 或者 Unix 的 IO 多路复用类似，它的存在使得我们可以轻松实现 1 拖 N，实现哪个先来就处理哪个。尽管 Select 和 Channel 比起标准库的协程 API 已经更接近业务开发了，不过个人认为它们仍属于相对底层的 API 封装，在实践当中多数情况下也可以使用 Flow API 来解决。&lt;/p&gt;\n&lt;/div&gt;&lt;div class=&quot;cl-preview-section&quot;&gt;&lt;p&gt;而这个 Flow API，完全就是响应式编程的协程版 API，我们简直可以照着 RxJava 来学习它，所以我们下一篇再见吧~~~&lt;/p&gt;\n&lt;/div&gt;";
// 为html反转码
article_content = article_content.replace(/\&lt\;/g, "<").replace(/\&gt\;/g, ">").replace(/\&amp\;/g, "&").replace(/\&quot\;/g, '"').replace(/\&apos\;/g, "'");
// 递归遍历dom，处理图片懒加载
function dfs(root) {
	var nodes = Array.prototype.slice.call(root.children);
	if (nodes.length) {
		nodes.forEach(function (node) {
			if(node.tagName == 'IMG') {
				var src = node.src;
				var alt = node.alt;
				var reg = /(?:imooc|mukewang)\.com\/[A-Za-z0-9]+?\.jpg$/;
				// ueditor 上传的图片，alt为原图高清
				if(reg.test(alt)) {
					!node.getAttribute('data-src') && node.setAttribute('data-src', alt);
					node.setAttribute('data-original', alt); // 直接显示原图
				} else {
					node.setAttribute('data-original', src);
				}
				node.setAttribute('class', 'lazyload');
				node.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC';
			}
			dfs(node);
		});
	}
}
// 创建手记内容dom节点
var articleEl = document.createElement("div");
articleEl.innerHTML = article_content;
// 遍历手记dom树
dfs(articleEl);
